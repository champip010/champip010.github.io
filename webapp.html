<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ï‡∏±‡∏ß‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤ (‡πÄ‡∏ï‡∏µ‡∏¢‡∏á 3-15)</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for better Thai display */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Noto+Sans+Thai:wght@100..900&display=swap');
        body {
            font-family: 'Noto Sans Thai', 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .timer-display {
            font-family: 'Inter', monospace; /* Use monospace for the timer numbers */
            font-size: 2.5rem;
            font-weight: 700;
            letter-spacing: 0.05em;
        }
        .blinking {
            animation: blinker 1s linear infinite;
        }
        @keyframes blinker {
            50% { opacity: 0; }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-extrabold text-indigo-700 mb-6 text-center">
            üè• ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏ï‡∏µ‡∏¢‡∏á (‡πÄ‡∏ï‡∏µ‡∏¢‡∏á 3 - 15)
        </h1>
        <p class="text-center text-gray-500 mb-8">
            ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏ô‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î '‡πÄ‡∏£‡∏¥‡πà‡∏°' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
        </p>

        <!-- Bed Cards Container -->
        <div id="bed-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Bed cards will be inserted here by JavaScript -->
        </div>
    </div>

    <script>
        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤
        const treatments = {
            '1200': { label: 'ÁêÜÁñó/ÁÅ∏ (‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ö‡∏≥‡∏ö‡∏±‡∏î/‡∏£‡∏°‡∏¢‡∏≤)', durationSeconds: 1200 }, // 20 ‡∏ô‡∏≤‡∏ó‡∏µ
            '540': { label: 'ÊãîÁΩê (‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏≠‡∏ö‡πÅ‡∏Å‡πâ‡∏ß)', durationSeconds: 540 }          // 9 ‡∏ô‡∏≤‡∏ó‡∏µ
        };

        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ï‡∏µ‡∏¢‡∏á: ‡πÄ‡∏ï‡∏µ‡∏¢‡∏á 3 ‡∏ñ‡∏∂‡∏á 15
        const bedNumbers = Array.from({ length: 15 - 3 + 1 }, (_, i) => i + 3);

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏ï‡∏µ‡∏¢‡∏á
        // { '3': { isActive: false, duration: 0, startTime: 0, timerId: null, label: '' } }
        let bedTimers = {};
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        /**
         * Utility function ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö MM:SS
         * @param {number} totalSeconds - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
         * @returns {string} ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ MM:SS
         */
        function formatTime(totalSeconds) {
            if (totalSeconds < 0) totalSeconds = 0;
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        /**
         * ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ï‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏
         * @param {number} bedNum - ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÄ‡∏ï‡∏µ‡∏¢‡∏á
         */
        function updateDisplay(bedNum) {
            const bedState = bedTimers[bedNum];
            const displayElement = document.getElementById(`time-${bedNum}`);
            const cardElement = document.getElementById(`card-${bedNum}`);

            if (!bedState || !displayElement || !cardElement) return;

            const timeElapsed = Math.floor((Date.now() - bedState.startTime) / 1000);
            const timeLeft = bedState.duration - timeElapsed;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
            displayElement.textContent = formatTime(timeLeft);

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏µ‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö
            if (timeLeft <= 0) {
                // ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
                displayElement.textContent = '‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!';
                displayElement.classList.remove('text-green-500', 'text-yellow-500', 'blinking');
                displayElement.classList.add('text-red-600', 'font-extrabold');
                cardElement.classList.remove('border-indigo-400');
                cardElement.classList.add('border-green-500', 'bg-green-50');
                clearInterval(bedState.timerId);
                bedState.timerId = null; // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ã‡πâ‡∏≥
            } else if (timeLeft <= 60) {
                // ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 1 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ (‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô)
                displayElement.classList.remove('text-green-500');
                displayElement.classList.add('text-yellow-500', 'blinking');
            } else {
                // ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥
                displayElement.classList.remove('text-yellow-500', 'text-red-600', 'blinking', 'font-extrabold');
                displayElement.classList.add('text-green-500');
            }
        }

        /**
         * ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ï‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏
         * @param {number} bedNum - ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÄ‡∏ï‡∏µ‡∏¢‡∏á
         */
        function startTimer(bedNum) {
            const selectElement = document.getElementById(`select-${bedNum}`);
            const durationKey = selectElement.value;

            if (!durationKey || !treatments[durationKey]) {
                console.error(`‡πÄ‡∏ï‡∏µ‡∏¢‡∏á ${bedNum}: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏ô‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Å‡πà‡∏≠‡∏ô`);
                // ‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ‡∏à‡∏£‡∏¥‡∏á‡∏Ñ‡∏ß‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ö‡∏ô UI ‡πÅ‡∏ó‡∏ô
                document.getElementById(`msg-${bedNum}`).textContent = '‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏ô‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤';
                setTimeout(() => document.getElementById(`msg-${bedNum}`).textContent = '', 3000);
                return;
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏´‡∏¢‡∏∏‡∏î‡∏ï‡∏±‡∏ß‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
            stopTimer(bedNum);

            const durationSeconds = treatments[durationKey].durationSeconds;

            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡∏°‡πà
            bedTimers[bedNum] = {
                isActive: true,
                duration: durationSeconds,
                startTime: Date.now(),
                label: treatments[durationKey].label,
                timerId: setInterval(() => updateDisplay(bedNum), 1000)
            };

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÅ‡∏•‡∏∞‡∏•‡πá‡∏≠‡∏Å‡∏õ‡∏∏‡πà‡∏°
            updateDisplay(bedNum);
            renderBedControls(bedNum);

            // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            document.getElementById(`msg-${bedNum}`).textContent = '';
        }

        /**
         * ‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏±‡∏ß‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ï‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏
         * @param {number} bedNum - ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÄ‡∏ï‡∏µ‡∏¢‡∏á
         */
        function stopTimer(bedNum) {
            const bedState = bedTimers[bedNum];

            if (bedState && bedState.timerId) {
                clearInterval(bedState.timerId);
            }

            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
            bedTimers[bedNum] = {
                isActive: false,
                duration: 0,
                startTime: 0,
                timerId: null,
                label: ''
            };

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°
            const displayElement = document.getElementById(`time-${bedNum}`);
            const cardElement = document.getElementById(`card-${bedNum}`);
            
            if (displayElement) {
                displayElement.textContent = '00:00';
                displayElement.classList.remove('text-green-500', 'text-yellow-500', 'text-red-600', 'blinking', 'font-extrabold');
                displayElement.classList.add('text-gray-400');
            }
            if (cardElement) {
                cardElement.classList.remove('border-green-500', 'bg-green-50');
                cardElement.classList.add('border-indigo-400', 'bg-white');
            }

            renderBedControls(bedNum);
        }

        /**
         * ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° (Start/Stop) ‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
         * @param {number} bedNum - ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÄ‡∏ï‡∏µ‡∏¢‡∏á
         */
        function renderBedControls(bedNum) {
            const bedState = bedTimers[bedNum];
            const controlsDiv = document.getElementById(`controls-${bedNum}`);
            const statusDiv = document.getElementById(`status-${bedNum}`);

            if (!controlsDiv || !statusDiv) return;

            const isRunning = bedState && bedState.timerId !== null;

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Select Options
            let selectOptions = '';
            for (const key in treatments) {
                selectOptions += `<option value="${key}">${treatments[key].label} (${key/60} ‡∏ô‡∏≤‡∏ó‡∏µ)</option>`;
            }

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            controlsDiv.innerHTML = `
                <select id="select-${bedNum}" ${isRunning ? 'disabled' : ''} 
                    class="w-full p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 bg-white text-sm">
                    <option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏ô‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤</option>
                    ${selectOptions}
                </select>
                <div class="mt-3 flex space-x-3">
                    <button onclick="startTimer(${bedNum})" ${isRunning ? 'disabled' : ''} 
                        class="w-full py-2 px-4 rounded-lg font-semibold transition duration-150 
                        ${isRunning ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-indigo-600 text-white hover:bg-indigo-700 shadow-md hover:shadow-lg active:bg-indigo-800'}">
                        ${isRunning ? '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°...' : '‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°'}
                    </button>
                    <button onclick="stopTimer(${bedNum})" ${isRunning || bedState.duration > 0 ? '' : 'disabled'}
                        class="w-full py-2 px-4 rounded-lg font-semibold transition duration-150 
                        ${isRunning || bedState.duration > 0 ? 'bg-red-500 text-white hover:bg-red-600 shadow-md hover:shadow-lg active:bg-red-700' : 'bg-gray-300 text-gray-500 cursor-not-allowed'}">
                        üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
                    </button>
                </div>
            `;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
            statusDiv.innerHTML = isRunning 
                ? `<p class="text-sm font-medium text-indigo-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤: ${bedState.label}</p>`
                : `<p class="text-sm text-gray-400">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°</p>`;

            // ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ select element
            if (isRunning) {
                const currentDurationKey = Object.keys(treatments).find(key => treatments[key].durationSeconds === bedState.duration);
                document.getElementById(`select-${bedNum}`).value = currentDurationKey;
            }
        }

        /**
         * ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡πÄ‡∏ï‡∏µ‡∏¢‡∏á
         */
        function initApp() {
            const container = document.getElementById('bed-container');
            
            bedNumbers.forEach(bedNum => {
                // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                bedTimers[bedNum] = { isActive: false, duration: 0, startTime: 0, timerId: null, label: '' };

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á Card HTML
                const cardHtml = `
                    <div id="card-${bedNum}" class="bg-white p-6 rounded-xl shadow-lg border-4 border-indigo-400 transition-all duration-300">
                        <div class="flex justify-between items-start mb-4">
                            <h2 class="text-xl md:text-2xl font-bold text-gray-800">
                                <span class="text-indigo-600 text-4xl mr-2">B${bedNum}</span> ‡πÄ‡∏ï‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà ${bedNum}
                            </h2>
                            <div id="status-${bedNum}"></div>
                        </div>

                        <div class="text-center my-6">
                            <p class="text-sm font-medium text-gray-500">‡πÄ‡∏ß‡∏•‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
                            <div id="time-${bedNum}" class="timer-display text-gray-400">
                                00:00
                            </div>
                        </div>
                        
                        <p id="msg-${bedNum}" class="text-red-500 text-center text-sm h-4 mb-2"></p>

                        <div id="controls-${bedNum}">
                            <!-- Controls will be rendered here -->
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', cardHtml);
                renderBedControls(bedNum); // ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            });
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à
        window.onload = initApp;

    </script>
</body>
</html>